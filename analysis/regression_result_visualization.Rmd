---
title: "Visualize Results"
author: "Brooke Staveland"
date: "4/7/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo <- FALSE,  # don't print the code chunk
  warning <- FALSE,  # don't print warnings
  message <- FALSE,  # don't print messages
  fig.width <- 12,  # set default width of figures
  fig.height <- 6,  # set default height of figures
  fig.align <- "center",  # always align figure in center
  fig.pos <- "H",  # always plot figure at the exact location of the code chunk
  cache <- TRUE)  # cache results

## libraries ##
library(tidyverse)
library(ggplot2)
library(magrittr)
# library(ggthemr)
library(grid)
library(gtable)
library(gridExtra)
library(wesanderson)
library(ggsci)
library(zoo)
library(kableExtra)
library(lme4)
library(RColorBrewer)
library(doParallel)
library(parallel)
library(foreach)
library(here)
library(fs)
library(ggcorrplot)
library(viridis)
library(lmtest)

## hand written functions ##
source(path(here(), "R", "load_behave_data.R"))
source(path(here(), "R", "prep_behave_data.R"))
source(path(here(), "R", "stretch_start_end.R"))
source(path(here(), "R", "load_high_gamma_data.R"))
source(path(here(), "R", "rolling_window_and_baseline.R"))
source(path(here(), "R", "run_permuted_regressions.R"))
source(path(here(), "R", "compile_results.R"))
source(path(here(), "R", "run_filtered_anova.R"))
source(path(here(), "R", "merge_stepped_anova_results.R"))
# source('~/Projects/nice_r_functions/ggpaired_pretty.R')
source(path(here(), "R", 'mutate_cond.R'))

## plotting helpers ##
# ggthemr("solarized")

## paralellization ##
nCores <- 2
registerDoParallel(nCores)

```

# Dictator Game Regression Results

This analysis script visualizes the output of the permuted regressions.

## Load Presentation

Load and prep presentation-locked results for all subjects.

```{r concatenate-results-presentation}

### any subject general vars ###
spec_vars <- c("*", "*")
abs_beta_val <- T
reg_name_one <- "self_diff"
reg_name_two <- "other_diff"
regions_to_combine <- c("Insula")
  
## IR39 ##

# combine different csvs #
presentation_results_39 <- compile_results(regions = regions_to_combine,
                                           type = "pres-locked",
                                           sub = "IR39",
                                           spec_vars = spec_vars,
                                           path = path(here(), "results", "IR39", "insula"),
                                           absBeta = abs_beta_val)

# runa anova for inequity results #
path_hg_clean <- path(here(), "munge", "IR39", "hg_behave_presentation_locked_extended_150_insula.csv")
hg_behave <-  read.csv(path_hg_clean)
run_filtered_anova(results = presentation_results_39,
                   brain_behave_data = hg_behave,
                   sub = "IR39",
                   region_name = "All",
                   reg_name_one = reg_name_one,
                   reg_name_two = reg_name_two,
                   all_results = T,
                   type = "pres-locked_insula")

# read back in the results #
region_name <- "All"
adv_pres_results_for_plots_39 <- read.csv(fs::path(here(), "results", "IR39", paste0(region_name, "_pres-locked_insula_anova_results_", reg_name_one, ".csv")))
dis_pres_results_for_plots_39 <- read.csv(fs::path(here(), "results", "IR39", paste0(region_name, "_pres-locked_insula_anova_results_", reg_name_two, ".csv")))


## IR35 ##

# combine different csvs #
presentation_results_35 <- compile_results(regions = regions_to_combine, 
                                           type = "pres-locked", 
                                           sub = "IR35", 
                                           spec_vars = spec_vars, 
                                           path = path(here(), "results", "IR35", "insula"), 
                                           absBeta = abs_beta_val)

# runa anova for inequity results #
path_hg_clean <- path(here(), "munge", "IR35", "hg_behave_presentation_locked_extended_150_insula.csv")
hg_behave <-  read.csv(path_hg_clean)
run_filtered_anova(results = presentation_results_35, 
                   brain_behave_data = hg_behave, 
                   sub = "IR35", 
                   region_name = "All", 
                   all_results = T, 
                   reg_name_one = reg_name_one, 
                   reg_name_two = reg_name_two,                    
                   type = "pres-locked_insula")

# read back in the results #
region_name <- "All"
adv_pres_results_for_plots_35 <- read.csv(fs::path(here(), "results", "IR35", paste0(region_name, "_pres-locked_insula_anova_results_", reg_name_one, ".csv")))
dis_pres_results_for_plots_35 <- read.csv(fs::path(here(), "results", "IR35", paste0(region_name, "_pres-locked_insula_anova_results_", reg_name_two, ".csv")))

## IR19 ##

# combine different csvs #
presentation_results_19 <- compile_results(regions = regions_to_combine, 
                                           type = "pres-locked", 
                                           sub = "IR19", 
                                           spec_vars = spec_vars, 
                                           path = path(here(), "results", "IR19", "insula"), 
                                           absBeta = abs_beta_val)

# runa anova for inequity results #
path_hg_clean <- path(here(), "munge", "IR19", "hg_behave_presentation_locked_extended_150_insula.csv")
hg_behave <-  read.csv(path_hg_clean)
hg_behave <- hg_behave %>% mutate(electrodes = gsub("POL ", "", electrodes)) # IR19 has weird elec names
run_filtered_anova(results = presentation_results_19, 
                   brain_behave_data = hg_behave, 
                   sub = "IR19", 
                   region_name = "All", 
                   reg_name_one = reg_name_one, 
                   reg_name_two = reg_name_two,                    
                   all_results = T, 
                   type = "pres-locked_insula")

# read back in the results #
region_name <- "All"
adv_pres_results_for_plots_19 <- read.csv(fs::path(here(), "results", "IR19", paste0(region_name, "_pres-locked_insula_anova_results_", reg_name_one, ".csv")))
dis_pres_results_for_plots_19 <- read.csv(fs::path(here(), "results", "IR19", paste0(region_name, "_pres-locked_insula_anova_results_", reg_name_two, ".csv")))

```


## Load Choice

Load and prep choice-locked results for all subjects.

```{r concatenate-results-choice}

### any subject general vars ###
spec_vars <- c("*", "*")
abs_beta_val <- T
reg_name_one <- "self_diff"
reg_name_two <- "other_diff"
regions_to_combine <- c("Insula")
  
## IR39 ##

# combine different csvs #
choice_results_39 <- compile_results(regions = regions_to_combine,
                                           type = "choice-locked",
                                           sub = "IR39",
                                           spec_vars = spec_vars,
                                           path = path(here(), "results", "IR39", "insula"),
                                           absBeta = abs_beta_val)

# runa anova for inequity results #
path_hg_clean <- path(here(), "munge", "IR39", "hg_behave_choice_locked_cut_fixation_150_insula.csv")
hg_behave <-  read.csv(path_hg_clean)
run_filtered_anova(results = choice_results_39,
                   brain_behave_data = hg_behave,
                   sub = "IR39",
                   region_name = "All",
                   reg_name_one = reg_name_one,
                   reg_name_two = reg_name_two,
                   all_results = T,
                   type = "choice-locked_insula")

# read back in the results #
region_name <- "All"
adv_choice_results_for_plots_39 <- read.csv(fs::path(here(), "results", "IR39", paste0(region_name, "_choice-locked_insula_anova_results_", reg_name_one, ".csv")))
dis_choice_results_for_plots_39 <- read.csv(fs::path(here(), "results", "IR39", paste0(region_name, "_choice-locked_insula_anova_results_", reg_name_two, ".csv")))


## IR35 ##

# combine different csvs #
regions_to_combine <- c("Insula")
choice_results_35 <- compile_results(regions = regions_to_combine, 
                                     type = "choice-locked", 
                                     sub = "IR35", 
                                     spec_vars = spec_vars, 
                                     path = path(here(), "results", "IR35", "insula"), 
                                     absBeta = abs_beta_val)

# runa anova for inequity results #
path_hg_clean <- path(here(), "munge", "IR35", "hg_behave_choice_locked_cut_fixation_150_insula.csv")
hg_behave <-  read.csv(path_hg_clean)
run_filtered_anova(results = choice_results_35, 
                   brain_behave_data = hg_behave, 
                   sub = "IR35", 
                   region_name = "All", 
                   all_results = T, 
                   reg_name_one = reg_name_one, 
                   reg_name_two = reg_name_two,                    
                   type = "choice-locked_insula")

# read back in the results #
region_name <- "All"
adv_choice_results_for_plots_35 <- read.csv(fs::path(here(), "results", "IR35", paste0(region_name, "_choice-locked_insula_anova_results_", reg_name_one, ".csv")))
dis_choice_results_for_plots_35 <- read.csv(fs::path(here(), "results", "IR35", paste0(region_name, "_choice-locked_insula_anova_results_", reg_name_two, ".csv")))

## IR19 ##

# combine different csvs #
regions_to_combine <- c("Insula")
choice_results_19 <- compile_results(regions = regions_to_combine, 
                                     type = "choice-locked", 
                                     sub = "IR19", 
                                     spec_vars = spec_vars, 
                                     path = path(here(), "results", "IR19", "insula"), 
                                     absBeta = abs_beta_val)

# runa anova for inequity results #
path_hg_clean <- path(here(), "munge", "IR19", "hg_behave_choice_locked_cut_fixation_150_insula.csv")
hg_behave <-  read.csv(path_hg_clean)
hg_behave <- hg_behave %>% mutate(electrodes = gsub("POL ", "", electrodes)) # IR19 has weird elec names
run_filtered_anova(results = choice_results_19, 
                   brain_behave_data = hg_behave, 
                   sub = "IR19", 
                   region_name = "All", 
                   reg_name_one = reg_name_one, 
                   reg_name_two = reg_name_two,                    
                   all_results = T, 
                   type = "choice-locked_insula")

# read back in the results #
region_name <- "All"
adv_choice_results_for_plots_19 <- read.csv(fs::path(here(), "results", "IR19", paste0(region_name, "_choice-locked_insula_anova_results_", reg_name_one, ".csv")))
dis_choice_results_for_plots_19 <- read.csv(fs::path(here(), "results", "IR19", paste0(region_name, "_choice-locked_insula_anova_results_", reg_name_two, ".csv")))

```

## Load Time- Warped

Load and prep presentation-locked results for all subjects.

```{r concatenate-results-time-warp}

### any subject general vars ###
spec_vars <- c("*", "*")
abs_beta_val <- T
reg_name_one <- "self_diff"
reg_name_two <- "other_diff"
regions_to_combine <- c("Insula")
  
## IR39 ##

# combine different csvs #
warped_results_39 <- compile_results(regions = regions_to_combine,
                                           type = "time-warped",
                                           sub = "IR39",
                                           spec_vars = spec_vars,
                                           path = path(here(), "results", "IR39", "insula"),
                                           absBeta = abs_beta_val)

warped_results_39 <- warped_results_39 %>% filter(electrode %in% insula_electrodes)

# runa anova for inequity results #
path_hg_clean <- path(here(), "munge", "IR39", "hg_behave_presentation_locked_extended_150_insula.csv")
hg_behave <-  read.csv(path_hg_clean)
run_filtered_anova(results = presentation_results_39,
                   brain_behave_data = hg_behave,
                   sub = "IR39",
                   region_name = "All",
                   reg_name_one = reg_name_one,
                   reg_name_two = reg_name_two,
                   all_results = T,
                   type = "time-warped_insula")

# read back in the results #
region_name <- "All"
adv_pres_results_for_plots_39 <- read.csv(fs::path(here(), "results", "IR39", paste0(region_name, "_time-warped_insula_anova_results_", reg_name_one, ".csv")))
dis_pres_results_for_plots_39 <- read.csv(fs::path(here(), "results", "IR39", paste0(region_name, "_time-warped_insula_anova_results_", reg_name_two, ".csv")))


## IR35 ##

# combine different csvs #
presentation_results_35 <- compile_results(regions = regions_to_combine, 
                                           type = "pres-locked", 
                                           sub = "IR35", 
                                           spec_vars = spec_vars, 
                                           path = path(here(), "results", "IR35", "insula"), 
                                           absBeta = abs_beta_val)

# runa anova for inequity results #
path_hg_clean <- path(here(), "munge", "IR35", "hg_behave_presentation_locked_extended_150_insula.csv")
hg_behave <-  read.csv(path_hg_clean)
run_filtered_anova(results = presentation_results_35, 
                   brain_behave_data = hg_behave, 
                   sub = "IR35", 
                   region_name = "All", 
                   all_results = T, 
                   reg_name_one = reg_name_one, 
                   reg_name_two = reg_name_two,                    
                   type = "pres-locked_insula")

# read back in the results #
region_name <- "All"
adv_pres_results_for_plots_35 <- read.csv(fs::path(here(), "results", "IR35", paste0(region_name, "_pres-locked_insula_anova_results_", reg_name_one, ".csv")))
dis_pres_results_for_plots_35 <- read.csv(fs::path(here(), "results", "IR35", paste0(region_name, "_pres-locked_insula_anova_results_", reg_name_two, ".csv")))

## IR19 ##

# combine different csvs #
presentation_results_19 <- compile_results(regions = regions_to_combine, 
                                           type = "pres-locked", 
                                           sub = "IR19", 
                                           spec_vars = spec_vars, 
                                           path = path(here(), "results", "IR19", "insula"), 
                                           absBeta = abs_beta_val)

# runa anova for inequity results #
path_hg_clean <- path(here(), "munge", "IR19", "hg_behave_presentation_locked_extended_150_insula.csv")
hg_behave <-  read.csv(path_hg_clean)
hg_behave <- hg_behave %>% mutate(electrodes = gsub("POL ", "", electrodes)) # IR19 has weird elec names
run_filtered_anova(results = presentation_results_19, 
                   brain_behave_data = hg_behave, 
                   sub = "IR19", 
                   region_name = "All", 
                   reg_name_one = reg_name_one, 
                   reg_name_two = reg_name_two,                    
                   all_results = T, 
                   type = "pres-locked_insula")

# read back in the results #
region_name <- "All"
adv_pres_results_for_plots_19 <- read.csv(fs::path(here(), "results", "IR19", paste0(region_name, "_pres-locked_insula_anova_results_", reg_name_one, ".csv")))
dis_pres_results_for_plots_19 <- read.csv(fs::path(here(), "results", "IR19", paste0(region_name, "_pres-locked_insula_anova_results_", reg_name_two, ".csv")))

```


## plotting functions

```{r plotting-functions}
ggthemr::ggthemr("pale", layout = "plain")
getPalette = colorRampPalette(brewer.pal(10, "Set1"))

ineq_plots <- function(df, title) {
# plots the bar plots of dif in R2 for inequity  
df %>%
    ungroup() %>%
    mutate(sig = if_else(perm_p < 0.05 & anova_p < 0.01, "Significant", "Insignificant")) %>%
    mutate_cond(sig == "Significant", sig = as.character(region)) %>%
    mutate(sig = relevel(factor(sig), ref = "Insignificant")) %>%
    mutate(bin = as.numeric(gsub("bin_", "", bin))) %>%
    arrange(bin) %>%
    ggplot(., aes( x = bin, y = diff_adj_r2, color = sig, fill = sig)) +
    geom_col(alpha = .5) +
    # geom_vline(aes(xintercept = which(levels(bin) %in% "post_1"))) +
    theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), panel.background = element_rect(fill = "white")) + 
    scale_fill_manual(values = c("grey", getPalette(4))) +
    scale_color_manual(values = c("grey", getPalette(4))) +
    labs(y = "Difference in Adj. R Squared", x = "Bins", fill = "Region", color = "Region") +
    facet_wrap(~electrode) + 
    ggtitle(title)
  
}

ineq_plots_choice <- function(df, title) {
# plots the bar plots of dif in R2 for inequity  
df %>%
    ungroup() %>%
    mutate(sig = if_else(perm_p < 0.05 & anova_p < 0.01, "Significant", "Insignificant")) %>%
    mutate_cond(sig == "Significant", sig = as.character(region)) %>%
    mutate(sig = relevel(factor(sig), ref = "Insignificant")) %>%
    mutate(bin = gsub("pre_", "-", bin)) %>%
    mutate(bin = as.numeric(gsub("post_", "", bin))) %>%
    arrange(bin) %>%
    ggplot(., aes( x = bin, y = diff_adj_r2, color = sig, fill = sig)) +
    geom_col(alpha = .5) +
    # geom_vline(aes(xintercept = which(levels(bin) %in% "post_1"))) +
    theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), panel.background = element_rect(fill = "white")) + 
    scale_fill_manual(values = c("grey", getPalette(4))) +
    scale_color_manual(values = c("grey", getPalette(4))) +
    labs(y = "Difference in Adj. R Squared", x = "Bins", fill = "Region", color = "Region") +
    facet_wrap(~electrode) + 
    ggtitle(title)
  
}

active_elec_plots <- function(df, var, title) {
  df %>%
    filter(predictor == var) %>%
    mutate(sig = if_else(perm_p < 0.0125 & p < 0.05, "Significant", "Insignificant")) %>%
    mutate_cond(sig == "Significant", sig = as.character(region)) %>%
    mutate(sig = relevel(factor(sig), ref = "Insignificant")) %>%
    # mutate(bin = factor(bin, levels = colnames(hg_data)[4:38])) %>%
    ggplot(., aes( x = bin, y = R2, color = sig, fill = sig)) +
    geom_col(alpha = .5) +
    # geom_vline(aes(xintercept = which(levels(bin) %in% "post_1"))) +
    theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), panel.background = element_rect(fill = "white")) + 
    scale_fill_manual(values = c("grey", getPalette(4))) +
    scale_color_manual(values = c("grey", getPalette(4))) +
    labs(y = "Adj. R Squared", x = "Bins", fill = "Region", color = "Region") +
    facet_wrap(~electrode) + 
    ggtitle(title)

}

combined_active_plots <- function(df, subject, num_rows, sig_thresh){
  df  %>%
    # filter(!predictor %in% c("ineq_advent", "ineq_disadvent")) %>%
    mutate(bin_sig = if_else((p < .05 & perm_p < sig_thresh), 1, 0)) %>%
    mutate(Beta = if_else(predictor == "ineq_advent", Beta * -1, Beta)) %>%
    mutate(bin_sig = if_else(Beta < 0 & bin_sig == 1, -1, bin_sig)) %>%
    group_by(bin, electrode) %>%
    mutate(bin_sum = sum(bin_sig)/6) %>%
    ungroup() %>%
    mutate(predictor = if_else(bin_sig == 0, "Insig", as.character(predictor))) %>%
    mutate(predictor = relevel(factor(predictor), ref = "Insig")) %>%
    mutate(bin = as.numeric(gsub("bin_", "", bin))) %>%
    arrange(bin) %>%
    ggplot(., aes(x= bin, y = bin_sig, fill = predictor, color = predictor)) + 
    geom_col(alpha = .5) + 
    theme(axis.text.x = element_text(angle = 90),
          # axis.ticks.x = element_blank(),
          panel.background = element_rect(fill = "white")) +
      scale_fill_manual(values = c("grey", getPalette(9))) +
      scale_color_manual(values = c("grey", getPalette(9))) +
      labs(y = "number of sig. predictors", x = "Bins", fill = "Region", color = "Region") +
    facet_wrap(~electrode, nrow = num_rows) +
    ggtitle(paste0(subject, " ~ thresh @ ", sig_thresh))
}

combined_active_plots_choice <- function(df, subject, num_rows, sig_thresh){
  df  %>%
    # filter(!predictor %in% c("ineq_advent", "ineq_disadvent")) %>%
    mutate(bin_sig = if_else((p < .05 & perm_p < sig_thresh), 1, 0)) %>%
    mutate(Beta = if_else(predictor == "ineq_advent", Beta * -1, Beta)) %>%
    mutate(bin_sig = if_else(Beta < 0 & bin_sig == 1, -1, bin_sig)) %>%
    group_by(bin, electrode) %>%
    mutate(bin_sum = sum(bin_sig)/6) %>%
    ungroup() %>%
    mutate(predictor = if_else(bin_sig == 0, "Insig", as.character(predictor))) %>%
    mutate(predictor = relevel(factor(predictor), ref = "Insig")) %>%
    mutate(bin = gsub("pre_", "-", bin)) %>%
    mutate(bin = as.numeric(gsub("post_", "", bin))) %>%
    arrange(bin) %>%
    ggplot(., aes(x= bin, y = bin_sig, fill = predictor, color = predictor)) + 
    geom_col(alpha = .5) + 
    geom_vline(xintercept = 0, color = "black") +
    theme(axis.text.x = element_text(angle = 90),
          # axis.ticks.x = element_blank(),
          panel.background = element_rect(fill = "white")) +
      scale_fill_manual(values = c("grey", getPalette(9))) +
      scale_color_manual(values = c("grey", getPalette(9))) +
      labs(y = "number of sig. predictors", x = "Bins", fill = "Region", color = "Region") +
    facet_wrap(~electrode, nrow = num_rows) +
    ggtitle(paste0(subject, " ~ thresh @ ", sig_thresh))
}

combined_active_plots_for_talk <- function(df, subject, num_rows, sig_thresh){
  df  %>%
    # filter(!predictor %in% c("ineq_advent", "ineq_disadvent")) %>%
    mutate(bin_sig = if_else((p < .05 & perm_p < sig_thresh), 1, 0)) %>%
    mutate(Beta = if_else(predictor == "ineq_advent", Beta * -1, Beta)) %>%
    mutate(bin_sig = if_else(Beta < 0 & bin_sig == 1, -1, bin_sig)) %>%
    group_by(bin, electrode) %>%
    mutate(bin_sum = sum(bin_sig)/6) %>%
    ungroup() %>%
    mutate(predictor_case = if_else(grepl("other|disadvent", predictor), "ther", "elf")) %>%
    mutate(predictor_case = if_else(bin_sig == 0, "Insig", as.character(predictor_case))) %>%
    mutate(predictor_case = relevel(factor(predictor_case), ref = "Insig")) %>%
    mutate(bin = as.numeric(gsub("bin_", "", bin))) %>%
    arrange(bin) %>%
    ggplot(., aes(x= bin, y = bin_sig, fill = predictor_case, color = predictor_case)) + 
    geom_col(alpha = .5) + 
    theme(axis.text.x = element_text(angle = 90),
          # axis.ticks.x = element_blank(),
          panel.background = element_rect(fill = "white")) +
      scale_fill_manual(values = c("grey", getPalette(9))) +
      scale_color_manual(values = c("grey", getPalette(9))) +
      labs(y = "number of sig. predictors", x = "Bins", fill = "Regressor", color = "Regressor") +
    facet_wrap(~electrode, nrow = num_rows) +
    ggtitle(paste0(subject))
}



combined_active_plots_choice_for_talk <- function(df, subject, num_rows, sig_thresh){
  df  %>%
    # filter(!predictor %in% c("ineq_advent", "ineq_disadvent")) %>%
    mutate(bin_sig = if_else((p < .05 & perm_p < sig_thresh), 1, 0)) %>%
    mutate(Beta = if_else(predictor == "ineq_advent", Beta * -1, Beta)) %>%
    mutate(bin_sig = if_else(Beta < 0 & bin_sig == 1, -1, bin_sig)) %>%
    group_by(bin, electrode) %>%
    mutate(bin_sum = sum(bin_sig)/6) %>%
    ungroup() %>%
    mutate(predictor_case = if_else(grepl("other|disadvent", predictor), "ther", "elf")) %>%
    mutate(predictor_case = if_else(bin_sig == 0, "Insig", as.character(predictor_case))) %>%
    mutate(predictor_case = relevel(factor(predictor_case), ref = "Insig")) %>%
    mutate(bin = gsub("pre_", "-", bin)) %>%
    mutate(bin = as.numeric(gsub("post_", "", bin))) %>%
    arrange(bin) %>%
    ggplot(., aes(x= bin, y = bin_sig, fill = predictor_case, color = predictor_case)) + 
    geom_col(alpha = .5) + 
    geom_vline(xintercept = 0, color = "black") +
    theme(axis.text.x = element_text(angle = 90),
          # axis.ticks.x = element_blank(),
          panel.background = element_rect(fill = "white")) +
      scale_fill_manual(values = c("grey", getPalette(8))) +
      scale_color_manual(values = c("grey", getPalette(8))) +
      labs(y = "number of sig. predictors", x = "Bins", fill = "Regressor", color = "Regressor") +
    facet_wrap(~electrode, nrow = num_rows) +
    ggtitle(paste0(subject))
}

```

## Presentation Results

```{r presentation-results}

## exclude mistaken regions!! ###
presentation_results_35 <- presentation_results_35 %>% filter(electrode != "LAC10-LAC11" & electrode != "LAC9-LAC10" & electrode != "LIN9-LIN10")
presentation_results_19 <- presentation_results_19 %>% filter(electrode != "LIN10-Ref-LIN11-Ref" & electrode != "LIN12-Ref-LIN13-Ref" & electrode != "LIN11-Ref-LIN12-Ref" & electrode != "LIN9-Ref-LIN10-Ref" & electrode != "RIN10-Ref-RIN11-Ref" & electrode != "RIN11-Ref-RIN12-Ref" & electrode != "RIN12-Ref-RIN13-Ref" & electrode != "RIN9-Ref-RIN10-Ref")

plot_39_005 <- combined_active_plots(presentation_results_39, "IR39 ~ Presentation", 2, sig_thresh = 0.005)
plot_35_005 <- combined_active_plots(presentation_results_35, "IR35 ~ Presentation", 2, sig_thresh = 0.005)
plot_19_005 <- combined_active_plots(presentation_results_19, "IR19 ~ Presentation", 3, sig_thresh = 0.005)

ggsave(filename = paste0(path(here(), './figures/plot_39_005.png')),
     device = "png",
     width = 20,
     height = 10,
     units = "cm",
     dpi = 200,
     plot =  print(plot(plot_39_05)) )

ggsave(filename = paste0(path(here(), './figures/plot_35_05.png')),
     device = "png",
     width = 20,
     height = 10,
     units = "cm",
     dpi = 200,
     plot =  print(plot(plot_35_05)) )

ggsave(filename = paste0(path(here(), './figures/plot_19_05.png')),
     device = "png",
     width = 20,
     height = 10,
     units = "cm",
     dpi = 200,
     plot =  print(plot(plot_19_05)) )



```

```{r pres-for-talk}
presentation_results_39_with_elec_info <- presentation_results_39 %>%
  mutate(elec_region = if_else(electrode == "LIN1-LIN2", "blue", 
                              if_else(electrode == "LOF3-LOF4", "purple",
                                      if_else(electrode == "LOF4-LOF5", "purple",
                                              if_else(electrode == "LOF5-LOF6", "purple",
                                                      if_else(electrode == "RAM5-RAM6", "yellow",
                                                              if_else(electrode == "RAM6-RAM7", "yellow",
                                                                      if_else(electrode == "RAM7-RAM8", "yellow",
                                                                              if_else(electrode == "RIN1-RIN2", "green",
                                                                                      if_else(electrode == "RIN2-RIN3", "blue",
                                                                                              if_else(electrode == "RIN3-RIN4", "blue", "help")))))))))))

presentation_results_39_with_elec_info <- presentation_results_39_with_elec_info %>% mutate(electrode = paste0(electrode, "-39"))

presentation_results_19_with_elec_info <- presentation_results_19 %>%
  mutate(electrode = gsub("-Ref-", "-", electrode)) %>%
  mutate(electrode = gsub("-Ref", "-19", electrode)) %>%
  mutate(elec_region = if_else(electrode == "LAM8-LAM9-19", "yellow", 
                              if_else(electrode == "LAM9-LAM10-19", "yellow",
                                      if_else(electrode == "LIN1-LIN2-19", "pink",
                                              if_else(electrode == "LIN2-LIN3-19", "green",
                                                      if_else(electrode == "LIN3-LIN4-19", "blue",
                                                              if_else(electrode == "LIN4-LIN5-19", "blue",
                                                                      if_else(electrode == "RAM7-RAM8-19", "yellow",
                                                                              if_else(electrode == "RAM8-RAM9-19", "yellow",
                                                                                      if_else(electrode == "RIN1-RIN2-19", "blue",
                                                                                              if_else(electrode == "RIN2-RIN3-19", "green",
                                                                                                      if_else(electrode == "RIN3-RIN4-19", "green",
                                                                                                             if_else(electrode == "RIN4-RIN5-19", "blue",
                                                                                                                     if_else(electrode == "RIN5-RIN6-19", "blue","help"))))))))))))))


presentation_results_35_with_elec_info <- presentation_results_35 %>%
  mutate(elec_region = if_else(electrode == "LIN1-LIN2", "yellow", 
                              if_else(electrode == "LIN2-LIN3", "pink",
                                      if_else(electrode == "LIN3-LIN4", "green",
                                              if_else(electrode == "LIN4-LIN5", "blue",
                                                      if_else(electrode == "RIN1-RIN2", "yellow",
                                                              if_else(electrode == "RIN2-RIN3", "pink",
                                                                      if_else(electrode == "RIN3-RIN4", "blue", "help"))))))))

presentation_results_35_with_elec_info <- presentation_results_35_with_elec_info %>% mutate(electrode = paste0(electrode, "-35"))

# combine them #
presentation_results_full <- rbind(presentation_results_19_with_elec_info, presentation_results_35_with_elec_info, presentation_results_39_with_elec_info)
presentation_results_full <- presentation_results_full %>% filter(!predictor %in% c("ineq_advent", "ineq_disadvent"))
blue_presentation <- presentation_results_full %>% filter(elec_region == "blue")
yellow_presentation <- presentation_results_full %>% filter(elec_region == "yellow")
pink_presentation <- presentation_results_full %>% filter(elec_region == "pink")
purple_presentation <- presentation_results_full %>% filter(elec_region == "purple")
green_presentation <- presentation_results_full %>% filter(elec_region == "green")

b_p <- combined_active_plots_for_talk(blue_presentation, "Blue Region", 4, sig_thresh = 0.0065)
y_p <- combined_active_plots_for_talk(yellow_presentation, "Yellow Region", 3, sig_thresh = 0.0065)
g_p <- combined_active_plots_for_talk(green_presentation, "Green Region", 3, sig_thresh = 0.0065)
purp_p <- combined_active_plots_for_talk(purple_presentation, "Purple Region", 3, sig_thresh = 0.0065)
pi_p <- combined_active_plots_for_talk(pink_presentation, "Pink Region", 3, sig_thresh = 0.0065)


ggsave(filename = paste0(path(here(), './figures/purple_pres.png')),
     device = "png",
     width = 10,
     height = 15,
     units = "cm",
     dpi = 200,
     plot =  print(plot(purp_p)) )

ggsave(filename = paste0(path(here(), './figures/pink_pres.png')),
     device = "png",
     width = 10,
     height = 15,
     units = "cm",
     dpi = 200,
     plot =  print(plot(pi_p)) )

ggsave(filename = paste0(path(here(), './figures/green_pres.png')),
     device = "png",
     width = 10,
     height = 15,
     units = "cm",
     dpi = 200,
     plot =  print(plot(g_p)) )

ggsave(filename = paste0(path(here(), './figures/yellow_pres.png')),
     device = "png",
     width = 15,
     height = 15,
     units = "cm",
     dpi = 200,
     plot =  print(plot(y_p)) )


ggsave(filename = paste0(path(here(), './figures/blue_pres.png')),
     device = "png",
     width = 15,
     height = 15,
     units = "cm",
     dpi = 200,
     plot =  print(plot(b_p)) )

```

## Choice Resutls

```{r choice_results-for-talk}

getPalette = colorRampPalette(brewer.pal(8, "Set1"))


## exclude mistaken regions!! ###
choice_results_35 <- choice_results_35 %>% filter(electrode != "LAC10-LAC11" & electrode != "LAC9-LAC10" & electrode != "LIN9-LIN10")
choice_results_19 <- choice_results_19 %>% filter(electrode != "LIN10-Ref-LIN11-Ref" & electrode != "LIN12-Ref-LIN13-Ref" & electrode != "LIN11-Ref-LIN12-Ref" & electrode != "LIN9-Ref-LIN10-Ref" & electrode != "RIN10-Ref-RIN11-Ref" & electrode != "RIN11-Ref-RIN12-Ref" & electrode != "RIN12-Ref-RIN13-Ref" & electrode != "RIN9-Ref-RIN10-Ref")

choice_results_39_with_elec_info <- choice_results_39 %>%
  mutate(elec_region = if_else(electrode == "LIN1-LIN2", "blue", 
                              if_else(electrode == "LOF3-LOF4", "purple",
                                      if_else(electrode == "LOF4-LOF5", "purple",
                                              if_else(electrode == "LOF5-LOF6", "purple",
                                                      if_else(electrode == "RAM5-RAM6", "yellow",
                                                              if_else(electrode == "RAM6-RAM7", "yellow",
                                                                      if_else(electrode == "RAM7-RAM8", "yellow",
                                                                              if_else(electrode == "RIN1-RIN2", "green",
                                                                                      if_else(electrode == "RIN2-RIN3", "blue",
                                                                                              if_else(electrode == "RIN3-RIN4", "blue", "help")))))))))))

choice_results_39_with_elec_info <- choice_results_39_with_elec_info %>% mutate(electrode = paste0(electrode, "-39"))

choice_results_19_with_elec_info <- choice_results_19 %>%
  mutate(electrode = gsub("-Ref-", "-", electrode)) %>%
  mutate(electrode = gsub("-Ref", "-19", electrode)) %>%
  mutate(elec_region = if_else(electrode == "LAM8-LAM9-19", "yellow", 
                              if_else(electrode == "LAM9-LAM10-19", "yellow",
                                      if_else(electrode == "LIN1-LIN2-19", "pink",
                                              if_else(electrode == "LIN2-LIN3-19", "green",
                                                      if_else(electrode == "LIN3-LIN4-19", "blue",
                                                              if_else(electrode == "LIN4-LIN5-19", "blue",
                                                                      if_else(electrode == "RAM7-RAM8-19", "yellow",
                                                                              if_else(electrode == "RAM8-RAM9-19", "yellow",
                                                                                      if_else(electrode == "RIN1-RIN2-19", "blue",
                                                                                              if_else(electrode == "RIN2-RIN3-19", "green",
                                                                                                      if_else(electrode == "RIN3-RIN4-19", "green",
                                                                                                             if_else(electrode == "RIN4-RIN5-19", "blue",
                                                                                                                     if_else(electrode == "RIN5-RIN6-19", "blue","help"))))))))))))))


choice_results_35_with_elec_info <- choice_results_35 %>%
  mutate(elec_region = if_else(electrode == "LIN1-LIN2", "yellow", 
                              if_else(electrode == "LIN2-LIN3", "pink",
                                      if_else(electrode == "LIN3-LIN4", "green",
                                              if_else(electrode == "LIN4-LIN5", "blue",
                                                      if_else(electrode == "RIN1-RIN2", "yellow",
                                                              if_else(electrode == "RIN2-RIN3", "pink",
                                                                      if_else(electrode == "RIN3-RIN4", "blue", "help"))))))))

choice_results_35_with_elec_info <- choice_results_35_with_elec_info %>% mutate(electrode = paste0(electrode, "-35"))

# combine them #
choice_results_full <- rbind(choice_results_19_with_elec_info, choice_results_35_with_elec_info, choice_results_39_with_elec_info)
choice_results_full <- choice_results_full %>% filter(!predictor %in% c("ineq_advent", "ineq_disadvent"))
blue_choice <- choice_results_full %>% filter(elec_region == "blue")
yellow_choice <- choice_results_full %>% filter(elec_region == "yellow")
pink_choice <- choice_results_full %>% filter(elec_region == "pink")
purple_choice <- choice_results_full %>% filter(elec_region == "purple")
green_choice <- choice_results_full %>% filter(elec_region == "green")

b_c <- combined_active_plots_choice_for_talk(blue_choice, "Blue Region", 4, sig_thresh = 0.0065)
y_c <- combined_active_plots_choice_for_talk(yellow_choice, "Yellow Region", 3, sig_thresh = 0.0065)
g_c <-combined_active_plots_choice_for_talk(green_choice, "Green Region", 3, sig_thresh = 0.0065)
purp_c <- combined_active_plots_choice_for_talk(purple_choice, "Purple Region", 3, sig_thresh = 0.0065)
pi_c <- combined_active_plots_choice_for_talk(pink_choice, "Pink Region", 3, sig_thresh = 0.065)

ggsave(filename = paste0(path(here(), './figures/purple_choice.png')),
     device = "png",
     width = 10,
     height = 15,
     units = "cm",
     dpi = 200,
     plot =  print(plot(purp_c)) )

ggsave(filename = paste0(path(here(), './figures/pink_choice.png')),
     device = "png",
     width = 10,
     height = 15,
     units = "cm",
     dpi = 200,
     plot =  print(plot(pi_c)) )

ggsave(filename = paste0(path(here(), './figures/green_choice.png')),
     device = "png",
     width = 10,
     height = 15,
     units = "cm",
     dpi = 200,
     plot =  print(plot(g_c)) )

ggsave(filename = paste0(path(here(), './figures/yellow_choice.png')),
     device = "png",
     width = 15,
     height = 15,
     units = "cm",
     dpi = 200,
     plot =  print(plot(y_c)) )

ggsave(filename = paste0(path(here(), './figures/blue_choice.png')),
     device = "png",
     width = 15,
     height = 15,
     units = "cm",
     dpi = 200,
     plot =  print(plot(b_c)) )

```

```{r more-choice-plots}
## plot it ##

combined_active_plots_choice(choice_results_39, "IR39-Choice", 2)
combined_active_plots_choice(choice_results_35, "IR35-Choice", 2)
combined_active_plots_choice(choice_results_19, "IR19-Choice", 3)

combined_active_plots_choice(choice_results_35, "IR35 ~ Norm Deviance", 3, .01)
```


## Inequity Results

### Presentation

Summary:
* IR34
 - Lin-3-4, adv, blue/green
* IR39
 - Lin-1-2, dis, blue
 - Lof-5-6, dis, purple
 - Rin-1-2, dis, green/blue
* IR19
 - Rin-1-2, adv, blue/green
 - Rin-1-2, dis, blue/green
 - Rin-1-2, dis, blue/green
 


```{r inequity-pres}

## remove sneaky electrodes
adv_pres_results_for_plots_35 <- adv_pres_results_for_plots_35 %>% filter(electrode != "LAC10-LAC11" & electrode != "LAC9-LAC10" & electrode != "LIN9-LIN10")
dis_pres_results_for_plots_35 <- dis_pres_results_for_plots_35 %>% filter(electrode != "LAC10-LAC11" & electrode != "LAC9-LAC10" & electrode != "LIN9-LIN10")

adv_pres_results_for_plots_19 <- adv_pres_results_for_plots_19 %>% filter(electrode != "LIN10-Ref-LIN11-Ref" & electrode != "LIN12-Ref-LIN13-Ref" & electrode != "LIN11-Ref-LIN12-Ref" & electrode != "LIN9-Ref-LIN10-Ref" & electrode != "RIN10-Ref-RIN11-Ref" & electrode != "RIN11-Ref-RIN12-Ref" & electrode != "RIN12-Ref-RIN13-Ref" & electrode != "RIN9-Ref-RIN10-Ref")
dis_pres_results_for_plots_19 <- dis_pres_results_for_plots_19 %>% filter(electrode != "LIN10-Ref-LIN11-Ref" & electrode != "LIN12-Ref-LIN13-Ref" & electrode != "LIN11-Ref-LIN12-Ref" & electrode != "LIN9-Ref-LIN10-Ref" & electrode != "RIN10-Ref-RIN11-Ref" & electrode != "RIN11-Ref-RIN12-Ref" & electrode != "RIN12-Ref-RIN13-Ref" & electrode != "RIN9-Ref-RIN10-Ref")


## Presentation ##

ineq_plots(adv_pres_results_for_plots_35, "Advantageous Inequality Results: IR35")
ineq_plots(dis_pres_results_for_plots_35, "Disdvantageous Inequality Results: IR35")

ineq_plots(adv_pres_results_for_plots_39, "Advantageous Inequality Results: IR39")
ineq_plots(dis_pres_results_for_plots_39, "Disdvantageous Inequality Results: IR39")

ineq_plots(adv_pres_results_for_plots_19, "Advantageous Inequality Results: IR19")
ineq_plots(dis_pres_results_for_plots_19, "Disdvantageous Inequality Results: IR19")

ineq_plots(adv_pres_results_for_plots_19, "Advantageous Difference Results: IR19")
ineq_plots(dis_pres_results_for_plots_19, "Disdvantageous Difference Results: IR19")

ineq_plots(adv_pres_results_for_plots_35, "Advantageous Difference Results: IR35")
ineq_plots(dis_pres_results_for_plots_35, "Disdvantageous Difference Results: IR35")


```


### Choice

```{r inequity-choice}
## Presentation ##

ineq_plots_choice(adv_choice_results_for_plots_35, "Advantageous Difference Results: IR35")
ineq_plots_choice(dis_choice_results_for_plots_35, "Disdvantageous Difference Results: IR35")

ineq_plots_choice(adv_choice_results_for_plots_39, "Advantageous Difference Results: IR39")
ineq_plots_choice(dis_choice_results_for_plots_39, "Disdvantageous Difference Results: IR39")

ineq_plots_choice(adv_choice_results_for_plots_19, "Advantageous Difference Results: IR19")
ineq_plots_choice(dis_choice_results_for_plots_19, "Disdvantageous Difference Results: IR19")

```


