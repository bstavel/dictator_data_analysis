---
title: "brain coverage"
author: "Brooke Staveland"
date: "`r format(Sys.time(), "%B %d, %Y")`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,  # don"t print the code chunk
  warning = FALSE,  # don"t print warnings
  message = FALSE,  # don"t print messages
  fig.width = 12,  # set default width of figures
  fig.height = 6,  # set default height of figures
  fig.align = "center",  # always align figure in center
  fig.pos = "H",  # always plot figure at the exact location of the code chunk
  cache = TRUE)  # cache results

## libraries ##
library(tidyverse)
library(ggplot2)
library(magrittr)
library(ggthemr)
library(grid)
library(gtable)
library(gridExtra)
library(wesanderson)
library(ggsci)
library(zoo)
library(kableExtra)
library(lme4)
library(RColorBrewer)
library(lme4)

## hand written functions ##

source("~/Projects/nice_r_functions/ggpaired_pretty.R")

```

# Updated notes on subjects for the dictator

Subjects: IR9  IR10  IR14  IR16  IR17  IR19  IR26  IR28  IR35  IR39  IR57 ST40 GP51 CP34 DA7

# Using and have Recons
* IR9: Only has loc meeting notes in orginal file-- look at both and fix with Bob
* IR10
* IR16
* IR19
* IR26
* IR28
* IR35
* IR39
* IR57 -- missing behavior
* ST40

# Waiting List

* GP51 -- missing behavioral and scans?
* CP34 -- waiting on scans
* DA7  -- waiting on scans

# Exlude list

* IR14/DG_s05 -- confusing behavior, and low IQ
* IR17 -- doesn't seem to be any insula electrodes


```{r read-data}

subjects_irvine <- c("IR9", "IR10", "IR16", "IR19",  "IR26",
                     "IR28",  "IR35",  "IR39",  "IR57")

for (sub in subjects_irvine) {
    # read in temp #
    temp_notes <- readxl::read_xlsx(paste0("~/Projects/knight_server/remote/ecog/DATA_FOLDER/Irvine/", sub, "/Notes/", sub, "_Elec_Notes.xlsx"))
    temp_notes$subject <- sub

    # rbind #
    if (sub == "IR9") {
      original <- readxl::read_xlsx(paste0("~/Projects/knight_server/remote/ecog/DATA_FOLDER/Irvine/",
                                           sub, "/Notes/", sub, "_Elec_Notes_original.xlsx"))
      colnames(original)[5] <- "Loc Meeting"
      temp_notes <- merge.data.frame(temp_notes, original, by.x = "Electrode", by.y = "contact")
      temp_notes <- temp_notes %>% select(-`Loc Meeting.x`) %>% rename(`Loc Meeting` = `Loc Meeting.y`)
      elec_notes <- temp_notes
    } else if (sub == "IR14") {
      colnames(temp_notes)[2] <- "Loc Meeting"
      temp_notes <- temp_notes[is.na(temp_notes$`Epileptic via Irvine`), ] # we want only blanks here, same as below
      temp_notes <- temp_notes[is.na(temp_notes$`status(old notes)`), ]
      temp_notes$Discard <- 0
      temp_notes$`Out of Brain` <- 0
      temp_notes$Epileptic <- 0
      elec_notes <- bind_rows(temp_notes, elec_notes)
    } else if (sub == "IR16") {
      original <- readxl::read_xlsx(paste0("~/Projects/knight_server/remote/ecog/DATA_FOLDER/Irvine/",
                                           sub, "/Notes/", sub, "_Elec_Notes_old.xlsx"))
      colnames(original)[2] <- "Loc Meeting"
      temp_notes <- merge.data.frame(temp_notes, original, by.x = "Electrode", by.y = "contact")
      temp_notes <- temp_notes %>% select(-`Loc Meeting.x`) %>% rename(`Loc Meeting` = `Loc Meeting.y`)
      temp_notes <- temp_notes[is.na(temp_notes$`Epileptic via Irvine`), ] # we want only blanks here, same as below
      temp_notes <- temp_notes[is.na(temp_notes$`status(old notes)`), ]
      temp_notes$Discard <- 0
      temp_notes$`Out of Brain` <- 0
      temp_notes$Epileptic <- 0
      elec_notes <- bind_rows(temp_notes, elec_notes)
    } else if (sub == "IR19") {
      temp_notes <- temp_notes[!is.na(temp_notes$`Loc Meeting`), ] # missing some localization data, Richard to fix, but for now exclude
      elec_notes <- bind_rows(temp_notes, elec_notes)
    } else {  
      elec_notes <- bind_rows(temp_notes, elec_notes)
    }
    
    # print(sub)
    # print(colnames(temp_notes))

}

#  ST40 #
st40_notes <- readxl::read_xlsx(paste0("~/Projects/knight_server/remote/ecog/DATA_FOLDER/Stanford/ST40/Notes/ST40_elecs_notes_Bob_meeting_2016_02_18.xlsx"))
st40_notes_pt1 <- st40_notes[, c(2, 4)]
st40_notes_pt2 <- st40_notes[, c(6, 7)]
colnames(st40_notes_pt1) <- c("Electrode", "Loc Meeting")
colnames(st40_notes_pt2) <- c("Electrode", "Loc Meeting")
st40_notes <- rbind(st40_notes_pt1, st40_notes_pt2)
st40_notes <- st40_notes[complete.cases(st40_notes), ]
st40_notes$Discard <- 0
st40_notes$`Out of Brain` <- 0
st40_notes$Epileptic <- 0
st40_notes$subject <- "ST40"

# GP51 #
## missing data ##

# merge other data centers #
elec_notes <- bind_rows(elec_notes, st40_notes)

# save to munge file #
write.csv(elec_notes, path(here(), "munge", "combined_electrode_info.csv"))

```

## clean Bad electrodes

```{r remove-bad-electrodes}

# notes columns marked lesions and epilepsy, should always be NA, verified on March 17 #
elec_notes_clean <- elec_notes %>% filter(is.na(Notes))
# throw out discards and out of brains and epileptics
elec_notes_clean <- elec_notes_clean %>% filter(Discard == 0 & `Out of Brain` == 0 & Epileptic == 0)
# throw out white matter and out of the brain from loc meeting #
elec_notes_clean <- elec_notes_clean %>% 
  filter(`Loc Meeting` != "WM" & `Loc Meeting` != "wm" & `Loc Meeting` != "out" & `Loc Meeting` != "out of brain" & `Loc Meeting` != "ventricle")
# save clean data #
write.csv(elec_notes_clean, path(here(), "munge", "combined_electrode_info_cleaned.csv"))

```


## Tabulate ROI


```{r count-roi}

count_elecs <- elec_notes_clean %>%
    mutate(ofc_loc_meeting = if_else(grepl("ofc", `Loc Meeting`, ignore.case = T), 1, 
                                   if_else(grepl("orb", `Loc Meeting`, ignore.case = T), 1, 0))) %>%
    mutate(insula_loc_meeting = if_else(grepl("insula", `Loc Meeting`, ignore.case = T), 1, 
                                   if_else(grepl("insular", `Loc Meeting`, ignore.case = T), 1, 0))) %>%
    mutate(mfg_loc_meeting = if_else(grepl("mfg", `Loc Meeting`, ignore.case = T), 1, 
                                   if_else(grepl("medial frontal", `Loc Meeting`, ignore.case = T), 1, 0))) %>%
    mutate(hinal_loc_meeting = if_else(grepl("entorhinal", `Loc Meeting`, ignore.case = T), 1, 
                                   if_else(grepl("perirhinal", `Loc Meeting`, ignore.case = T), 1, 0))) %>%
    mutate(sts_loc_meeting = if_else(grepl("sts", `Loc Meeting`, ignore.case = T), 1, 
                                   if_else(grepl("superior temporal", `Loc Meeting`, ignore.case = T), 1, 0))) %>%
    mutate(cingulate_loc_meeting = if_else(grepl("cingulate", `Loc Meeting`, ignore.case = T), 1, 0)) %>%
    mutate(ca1_loc_meeting = if_else(grepl("ca1", `Loc Meeting`, ignore.case = T), 1, 0))


```

## subject specific csvs 

```{r save_IR35_elecs}
## save only the IR39 electrodes in our ROI ##

# exclude areas outside our interest #
roi_IR35 <- count_elecs %>%
  filter(subject == "IR35") %>%
  filter(ofc_loc_meeting == 1 | insula_loc_meeting == 1 | mfg_loc_meeting == 1 | hinal_loc_meeting == 1 | sts_loc_meeting == 1 | cingulate_loc_meeting == 1 | ca1_loc_meeting == 1 )

# save #
write.csv(roi_IR35, path(here(), "munge", "IR35_elecs_of_interest.csv"))
```

```{r save_IR39_elecs}

## save only the IR39 electrodes in our ROI ##

# exclude areas outside our interest #
roi_IR39 <- count_elecs %>%
  filter(subject == "IR39") %>%
  filter(ofc_loc_meeting == 1 | insula_loc_meeting == 1 | mfg_loc_meeting == 1 | hinal_loc_meeting == 1 | sts_loc_meeting == 1 | cingulate_loc_meeting == 1 | ca1_loc_meeting == 1 )

# save #
write.csv(roi_IR39, path(here(), "munge", "IR39_elecs_of_interest.csv"))
```

```{r tables}

table_ofc <- count_elecs %>% filter(ofc_loc_meeting == 1)
table(table_ofc$subject)

table_cing <- count_elecs %>% filter(cingulate_loc_meeting == 1)
table(table_cing$subject)

table_insula <- count_elecs %>% filter(insula_loc_meeting == 1)
table(table_insula$subject)

# save #
write.csv(table_insula, path(here(), "munge", "insula_electrodes.csv"))
write.csv(table_cing, path(here(), "munge", "cingulate_electrodes.csv"))
write.csv(table_ofc, path(here(), "munge", "ofc_electrodes.csv"))
```

